@prefix mydomain: <http://tib.eu/gesah/individual> .
@prefix gesah: <http://ontology.tib.eu/gesah/> .
@prefix display: <http://vitro.mannlib.cornell.edu/ontologies/display/1.1#>

gesah:Drawing display:hasCustomView mydomain:imageSearchShortView .
gesah:Print display:hasCustomView mydomain:imageSearchShortView .
gesah:Photomechanical_Print display:hasCustomView mydomain:imageSearchShortView .
gesah:Painting display:hasCustomView mydomain:imageSearchShortView .
gesah:Digital_Image display:hasCustomView mydomain:imageSearchShortView .

mydomain:imageSearchShortView 
  a display:customViewForIndividual ; 
  display:appliesToContext "SEARCH" ;
  display:hasTemplate "image_search_short_view.ftl" ;
  display:hasDataGetter mydomain:elementImageSearchShortViewDataGetter ;
  display:hasDataGetter mydomain:elementCreationDateSearchShortViewDataGetter ;
  display:hasDataGetter mydomain:elementInfoSearchShortViewDataGetter .

mydomain:elementInfoSearchShortViewDataGetter
  a <java:edu.cornell.mannlib.vitro.webapp.utils.dataGetter.SparqlQueryDataGetter> ;
  display:saveToVar "participations" ;
  display:query
     """
	PREFIX vitro:    <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
	PREFIX gesah:    <http://ontology.tib.eu/gesah/>
	PREFIX rdfs:     <http://www.w3.org/2000/01/rdf-schema#>
	SELECT DISTINCT ?type ?name ?role
	WHERE {
	      ?individualUri gesah:output_of_creation|gesah:output_of_production|gesah:object_of_edition ?participation .
	      ?participation vitro:mostSpecificType ?type . 
	      ?participant gesah:participates_in ?participation .
	      ?participant rdfs:label ?name .
	      ?participant gesah:has_role ?participantRole .
	      ?participantRole gesah:has_role_type ?roleType .
	      ?roleType rdfs:label ?role .
	} ORDER BY ?type ?name ?role
     """ .
     
mydomain:elementImageSearchShortViewDataGetter
  a <java:edu.cornell.mannlib.vitro.webapp.utils.dataGetter.SparqlQueryDataGetter> ;
  display:saveToVar "imageInfo" ;
  display:query
     """
     PREFIX gesah: <http://ontology.tib.eu/gesah/>
     SELECT DISTINCT ?barcode ?fileNum
        WHERE {
            {
                ?individualUri gesah:has_digital_representation ?digRep .
                ?digRep gesah:barcode ?barcode .
                ?digRep gesah:image_file_number ?fileNum .
            }
            UNION
            {
                ?individualUri a gesah:Digital_Image .
                ?individualUri gesah:barcode ?barcode .
                ?individualUri gesah:image_file_number ?fileNum .
            }
        } ORDER BY ASC(?fileNum) LIMIT 1 OFFSET 1
     """ .
     
mydomain:elementCreationDateSearchShortViewDataGetter
  a <java:edu.cornell.mannlib.vitro.webapp.utils.dataGetter.SparqlQueryDataGetter> ;
  display:saveToVar "creationDate" ;
  display:query
     """
	    PREFIX vitro:    <http://vitro.mannlib.cornell.edu/ns/vitro/0.7#>
		PREFIX gesah:    <http://ontology.tib.eu/gesah/>
		SELECT ?date
		WHERE {
		      <https://vivo.tib.eu/gesah/individual/n868> gesah:output_of_creation ?participation .
		      ?participation vitro:mostSpecificType gesah:Creation . 
	                ?participation gesah:literal_date_appellation ?date .
		} LIMIT 1
     """ .
     
